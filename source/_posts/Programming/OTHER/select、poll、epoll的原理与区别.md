---
title: select、poll、epoll的原理与区别
tags:
  - io
categories:
  - progam
cover: 'https://images.ansore.top/i/2022/04/27/626944741bcd8.jpg'
abbrlink: '63893811'
date: 2021-05-17 14:20:31
---

# select、poll、epoll的原理与区别

1. select 同步多路IO复用

![select](https://images.ansore.top/i/2022/05/04/62726c8f19252.png)

时间复杂度:O(n)

fd_set(监听的端口个数)：32位机默认是1024个，64位机默认是2048。

**缺点**：

（1）单进程可以打开fd有限制；

（2）对socket进行扫描时是线性扫描，即采用轮询的方法，效率较低；

（2）用户空间和内核空间的复制非常消耗资源

2. poll

同步多路IO复用

调用过程和select类似

时间复杂度:O(n)

其和select不同的地方：采用**链表**的方式替换原有fd_set数据结构,而使其**没有连接数的限制**。

3. epoll

同步多路IO复用

![select](https://images.ansore.top/i/2022/05/04/62726c92eae21.png)

时间复杂度:O(1)

epoll的工作方式

epoll的两种工作方式：1.水平触发（LT）2.边缘触发（ET） 
**LT模式**：若就绪的事件一次没有处理完要做的事件，就会一直去处理。即就会将没有处理完的事件继续放回到就绪队列之中（即那个内核中的链表），一直进行处理。 
**ET模式**：就绪的事件只能处理一次，若没有处理完会在下次的其它事件就绪时再进行处理。而若以后再也没有就绪的事件，那么剩余的那部分数据也会随之而丢失。 
由此可见：ET模式的效率比LT模式的效率要高很多。只是如果使用ET模式，就要保证每次进行数据处理时，要将其处理完，不能造成数据丢失，这样对编写代码的人要求就比较高。 
注意：ET模式只支持非阻塞的读写：为了保证数据的完整性

**总结：**

**综上，在选择select，poll，epoll时要根据具体的使用场合以及这三种方式的自身特点。**

**1、表面上看epoll的性能最好，但是在连接数少并且连接都十分活跃的情况下，select和poll的性能可能比epoll好，毕竟epoll的通知机制需要很多函数回调。**

**2、select低效是因为每次它都需要轮询。但低效也是相对的，视情况而定，也可通过良好的设计改善**

（1）select，poll实现需要自己不断轮询所有fd集合，直到设备就绪，期间可能要睡眠和唤醒多次交替。而epoll其实也需要调用epoll_wait不断轮询就绪链表，期间也可能多次睡眠和唤醒交替，但是它是设备就绪时，调用回调函数，把就绪fd放入就绪链表中，并唤醒在epoll_wait中进入睡眠的进程。虽然都要睡眠和交替，但是select和poll在“醒着”的时候要遍历整个fd集合，而epoll在“醒着”的时候只要判断一下就绪链表是否为空就行了，这节省了大量的CPU时间。这就是回调机制带来的性能提升。

（2）select，poll每次调用都要把fd集合从用户态往内核态拷贝一次，并且要把current往设备等待队列中挂一次，而epoll只要一次拷贝，而且把current往等待队列上挂也只挂一次（在epoll_wait的开始，注意这里的等待队列并不是设备等待队列，只是一个epoll内部定义的等待队列）。这也能节省不少的开销。
