---
title: cmake之编译单个源文件
tags:
  - cmake
categories:
  - cmake
cover: 'https://img.ansore.top/2022/04/27/626930c198398.jpg'
abbrlink: d642b63b
date: 2021-02-24 09:52:44
---

# 单个源文件

假设现在我们的项目中只有一个源文件 [main.cc](http://main.cc/) ，该程序的用途是计算一个数的指数幂。

```c
#include <stdio.h>
#include <stdlib.h>

/**
 * power - Calculate the power of number.
 * @param base: Base value.
 * @param exponent: Exponent value.
 *
 * @return base raised to the power exponent.
 */
double power(double base, int exponent)
{
    int result = base;
    int i;
    
    if (exponent == 0) {
        return 1;
    }
    
    for(i = 1; i < exponent; ++i){
        result = result * base;
    }

    return result;
}

int main(int argc, char *argv[])
{
    if (argc < 3){
        printf("Usage: %s base exponent \n", argv[0]);
        return 1;
    }
    double base = atof(argv[1]);
    int exponent = atoi(argv[2]);
    double result = power(base, exponent);
    printf("%g ^ %d is %g\n", base, exponent, result);
    return 0;
}
```

## **编写 CMakeLists.txt**

首先编写 CMakeLists.txt 文件，并保存在与 **[main.cc](http://main.cc/)** 源文件同个目录下：

```bash
# CMake 最低版本号要求
cmake_minimum_required (VERSION 2.8)

# 项目信息
project (Demo1)

# 指定生成目标
add_executable(Demo main.cc)
```

CMakeLists.txt 的语法比较简单，由命令、注释和空格组成，其中命令是不区分大小写的。符号 `#` 后面的内容被认为是注释。命令由命令名称、小括号和参数组成，参数之间使用空格进行间隔。

对于上面的 CMakeLists.txt 文件，依次出现了几个命令：

- `cmake_minimum_required`：指定运行此配置文件所需的 CMake 的最低版本；
- `project`：参数值是 `Demo1`，该命令表示项目的名称是 `Demo1` 。
- `add_executable`： 将名为 **[main.cc](http://main.cc/)** 的源文件编译成一个名称为 Demo 的可执行文件。

## 编译**项目**

之后，在当前目录执行 `cmake .` ，得到 Makefile 后再使用 `make` 命令编译得到 Demo1 可执行文件。
