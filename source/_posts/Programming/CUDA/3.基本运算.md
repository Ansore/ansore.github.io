---
title: CUDA之基本运算
tags:
  - cuda
categories:
  - cuda
cover: 'https://images.ansore.top/i/2022/05/04/627269888a5c7.jpg'
abbrlink: 38c8e9cc
date: 2021-05-04 16:52:44
---

# 基本运算

main.cu

```cpp
#include <stdio.h>

__global__ void add(int *a, int *b, int *c, int num) {
  int i = threadIdx.x;
  if(i < num) {
    c[i] = a[i] + b[i];
  }
}

int main(int argc, char *argv[])
{
  int num = 10;
  int a[num], b[num], c[num];
  int *a_gpu, *b_gpu, *c_gpu;

  for(int i = 0; i < num; i ++) {
    a[i] = i;
    b[i] = i + i;
  }

  cudaMalloc((void **) &a_gpu, num * sizeof(int));
  cudaMalloc((void **) &b_gpu, num * sizeof(int));
  cudaMalloc((void **) &c_gpu, num * sizeof(int));

  // copy data
  cudaMemcpy(a_gpu, a, num * sizeof(int), cudaMemcpyHostToDevice);
  cudaMemcpy(b_gpu, b, num * sizeof(int), cudaMemcpyHostToDevice);

  // do
  add<<<1, num>>>(a_gpu, b_gpu, c_gpu, num);

  // get data
  cudaMemcpy(c, c_gpu, num * sizeof(int), cudaMemcpyDeviceToHost);

  // visualization
  for(int i = 0; i < num; i++) {
    printf("%d + %d = %d\n", a[i], b[i], c[i]);
  }
  printf("\n");

  cudaFree(a_gpu);
  cudaFree(b_gpu);
  cudaFree(c_gpu);
  return 0;
}
```

结果：

```
0 + 0 = 0
1 + 2 = 3
2 + 4 = 6
3 + 6 = 9
4 + 8 = 12
5 + 10 = 15
6 + 12 = 18
7 + 14 = 21
8 + 16 = 24
9 + 18 = 27
```
